import{r as m}from"./request-B1Pnm9MM.js";import{_ as S,f as d,j as z,k as F,h as N,g as B,c as L,w as n,r as i,i as P,o as I,b as c,a,d as p,t as h}from"./index-CQa1UL8_.js";const q={setup(){const g=JSON.parse(localStorage.getItem("user_info")||"{}"),l=d(!1),v=d([]),t=d(!1),b=d(0),y=z({page:1,pageSize:10}),o=z({id:null,title:"",startTime:"",endTime:"",detail:""}),u=d("Add Apply"),r="120px",A={rating:[{required:!0,message:"Please select rating",trigger:"blur"}]},f=d(null),s=async()=>{l.value=!0,v.value=await m.get("https://applies-fyoxpel6ba-uc.a.run.app",{params:{...y,search_field:"userId",search:g.id}});const e=await m.get("https://getallapplys-fyoxpel6ba-uc.a.run.app",{params:{userId:g.id}});let _=0;for(const D of e)D.rating&&(_+=D.rating);b.value=_/e.length,l.value=!1},T=e=>{m.post("https://applies-fyoxpel6ba-uc.a.run.app",e).then(()=>{s(),t.value=!1})},C=e=>{o.id=e.id,o.title=e.title,o.startTime=e.startTime,o.endTime=e.endTime,o.detail=e.detail,t.value=!0},x=()=>{m.put("https://applies-fyoxpel6ba-uc.a.run.app",o).then(()=>{s(),t.value=!1})},k=e=>{m.delete(`https://applies-fyoxpel6ba-uc.a.run.app?id=${e}`).then(()=>{s()})},w=()=>{o.id=null,o.title="",o.startTime="",o.endTime="",o.detail="",u.value="Add Apply",t.value=!0},V=()=>{f.value.validate(e=>{e&&(o.id?x():T(o))})};return F(()=>{s()}),{applies:v,dialogVisible:t,form:o,formTitle:u,formLabelWidth:r,rules:A,applyFormRef:f,ratingApply:C,deleteApply:k,addNewApply:w,submitForm:V,showLoading:l,onPage:e=>{y.page=e,s()},avgRating:b}}},E={style:{"margin-bottom":"20px"}},U={style:{"margin-top":"20px"}},W={slot:"footer",class:"dialog-footer"};function j(g,l,v,t,b,y){const o=i("el-button"),u=i("el-space"),r=i("el-table-column"),A=i("el-tag"),f=i("el-popover"),s=i("el-table"),T=i("el-pagination"),C=i("el-rate"),x=i("el-form-item"),k=i("el-form"),w=i("el-dialog"),V=i("el-card"),R=P("loading");return I(),N("div",null,[B((I(),L(V,null,{default:n(()=>[c("div",E,[a(u,null,{default:n(()=>[a(o,{onClick:l[0]||(l[0]=e=>g.$router.push({name:"Apply"})),type:"success"},{default:n(()=>l[4]||(l[4]=[p("Add Apply")])),_:1}),c("div",null,"The total average score of participation was: "+h(t.avgRating.toFixed(2)),1)]),_:1})]),a(s,{data:t.applies.data,style:{width:"100%"}},{default:n(()=>[a(r,{align:"center",prop:"id",label:"ID"}),a(r,{align:"center",prop:"title",label:"Title"}),a(r,{align:"center",prop:"startTime",label:"Start Time"}),a(r,{align:"center",prop:"endTime",label:"End Time"}),a(r,{align:"center",label:"Detail"},{default:n(({row:e})=>[a(f,{placement:"top",width:"300",trigger:"hover"},{reference:n(()=>[a(A,{type:"info"},{default:n(()=>l[5]||(l[5]=[p("Detail")])),_:1})]),default:n(()=>[c("p",null,h(e.detail),1)]),_:2},1024)]),_:1}),a(r,{align:"center",label:"Rating"},{default:n(({row:e})=>[p(h(e.rating||0),1)]),_:1}),a(r,{align:"center",label:"Actions"},{default:n(({row:e})=>[a(o,{onClick:_=>t.ratingApply(e),type:"primary",size:"small"},{default:n(()=>l[6]||(l[6]=[p("Rating")])),_:2},1032,["onClick"]),a(o,{onClick:_=>t.deleteApply(e.id),type:"danger",size:"small"},{default:n(()=>l[7]||(l[7]=[p("Delete")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),c("div",U,[a(T,{"current-page":t.applies.page,"page-size":t.applies.pageSize,total:t.applies.total,onCurrentChange:t.onPage,background:"",layout:"prev, pager, next"},null,8,["current-page","page-size","total","onCurrentChange"])]),a(w,{title:t.formTitle,modelValue:t.dialogVisible,"onUpdate:modelValue":l[3]||(l[3]=e=>t.dialogVisible=e),width:"30%"},{default:n(()=>[a(k,{model:t.form,ref:"applyFormRef",rules:t.rules},{default:n(()=>[a(x,{label:"Rating","label-width":t.formLabelWidth,prop:"rating"},{default:n(()=>[a(C,{modelValue:t.form.rating,"onUpdate:modelValue":l[1]||(l[1]=e=>t.form.rating=e)},null,8,["modelValue"])]),_:1},8,["label-width"])]),_:1},8,["model","rules"]),c("div",W,[a(o,{onClick:l[2]||(l[2]=e=>t.dialogVisible=!1)},{default:n(()=>l[8]||(l[8]=[p("Cancel")])),_:1}),a(o,{type:"primary",onClick:t.submitForm},{default:n(()=>l[9]||(l[9]=[p("Confirm")])),_:1},8,["onClick"])])]),_:1},8,["title","modelValue"])]),_:1})),[[R,t.showLoading]])])}const O=S(q,[["render",j],["__scopeId","data-v-5565d1b8"]]);export{O as default};
